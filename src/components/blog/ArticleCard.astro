---
import type { CollectionEntry } from 'astro:content';
import { cn } from "../../lib/utils";

interface Props {
  article: CollectionEntry<'blog'>;
  variant?: "default" | "featured" | "horizontal";
}

const { article, variant = "default" } = Astro.props;
const { data } = article;
/*const slug = article.id.split('/').pop()?.replace(/\.[^/.]+$/, "") || article.id;*/

// Split the ID (e.g., "2025/01/my-post.md") into parts
const pathParts = article.id.split('/');

// Extract year and month
const year = pathParts[0];
const month = pathParts[1];

// Extract filename and strip extension
const fileName = pathParts[pathParts.length - 1].replace(/\.[^/.]+$/, "");

// Construct the full URL-friendly slug
const slug = `${year}/${month}/${fileName}`;
---

{variant === "featured" && (
  <article class="group relative overflow-hidden rounded-3xl border border-border bg-card transition-all hover:border-primary/30 hover:shadow-xl">
    <div class={cn("grid gap-0", data.image ? "lg:grid-cols-2" : "lg:grid-cols-1")}>
      <!-- Image Column -->
      {data.image && (
        <div class="relative h-64 lg:h-auto overflow-hidden">
          <img 
            src={data.image} 
            alt={data.title}
            class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent lg:hidden"></div>
        </div>
      )}

      <!-- Content Column -->
      <div class="p-8 lg:p-12 flex flex-col justify-center">
        <div class="mb-6 flex items-center gap-3">
          <span class="inline-flex rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">
            {data.subCategorySlug}
          </span>
          <span class="flex items-center gap-1.5 text-sm text-muted-foreground">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 6v6l4 2" />
            </svg>
            {data.readTime}
          </span>
        </div>

        <a href={`/blog/${slug}`}>
          <h3 class="font-serif text-3xl font-bold text-foreground sm:text-4xl text-balance group-hover:text-primary transition-colors leading-tight">
            {data.title}
          </h3>
        </a>
        
        <p class="mt-6 text-lg text-muted-foreground leading-relaxed line-clamp-3">
          {data.excerpt}
        </p>

        <div class="mt-10 flex items-center gap-6">
          <a
            href={`/blog/${slug}`}
            class="inline-flex items-center rounded-xl bg-primary px-6 py-3 text-sm font-semibold text-primary-foreground hover:bg-primary/90 transition-all hover:shadow-lg active:scale-95"
          >
            Read Article
            <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
          </a>
          
          <div class="flex items-center gap-3">
            <div class="h-8 w-8 rounded-full bg-muted flex items-center justify-center text-xs font-bold text-muted-foreground">
              {data.authorSlug.charAt(0).toUpperCase()}
            </div>
            <span class="text-sm font-medium text-muted-foreground">{data.authorSlug}</span>
          </div>
        </div>
      </div>
    </div>
  </article>
)}

{variant === "horizontal" && (
  <article class="group relative overflow-hidden rounded-2xl border border-border bg-card p-6 transition-all hover:border-primary/30 hover:shadow-lg">
    <div class="flex flex-col sm:flex-row gap-4">
      <div class="flex-1">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground">
            {data.subCategorySlug}
          </span>
          <span class="flex items-center gap-1.5 text-sm text-muted-foreground">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 6v6l4 2" />
            </svg>
            {data.readTime}
          </span>
        </div>
        <a href={`/blog/${slug}`}>
          <h3 class="font-serif text-xl font-semibold text-foreground group-hover:text-primary transition-colors text-balance">
            {data.title}
          </h3>
        </a>
        <p class="mt-2 text-muted-foreground text-sm leading-relaxed line-clamp-2">
          {data.excerpt}
        </p>
        <div class="mt-4 flex flex-wrap gap-2">
          {data.tags && data.tags.slice(0, 3).map((tag) => (
            <a
              href={`/tag/${tag}`}
              class="text-xs text-muted-foreground hover:text-primary transition-colors"
            >
              #{tag}
            </a>
          ))}
        </div>
      </div>
      <div class="flex items-end sm:items-center">
        <a
          href={`/blog/${slug}`}
          class="inline-flex items-center text-sm font-medium text-primary hover:text-primary/80 transition-colors"
        >
          Read More
          <svg class="ml-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M12 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>
  </article>
)}

{variant === "default" && (
  <article class="group relative overflow-hidden rounded-2xl border border-border bg-card p-6 transition-all hover:border-primary/30 hover:shadow-lg">
    <span class="mb-3 inline-flex rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground">
      {data.subCategorySlug}
    </span>
    <a href={`/blog/${slug}`}>
      <h3 class="font-serif text-xl font-semibold text-foreground group-hover:text-primary transition-colors text-balance">
        {data.title}
      </h3>
    </a>
    <p class="mt-2 text-muted-foreground text-sm leading-relaxed line-clamp-2">
      {data.excerpt}
    </p>
    <div class="mt-4 flex items-center justify-between">
      <span class="flex items-center gap-1.5 text-sm text-muted-foreground">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" />
          <path d="M12 6v6l4 2" />
        </svg>
        {data.readTime}
      </span>
      <a
        href={`/blog/${slug}`}
        class="inline-flex items-center text-sm font-medium text-primary hover:text-primary/80 transition-colors"
      >
        Read More
        <svg class="ml-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M12 5l7 7-7 7" />
        </svg>
      </a>
    </div>
  </article>
)}
