---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { getOrganizationSchema } from '@/utils/schema';
import { CategoriesSection } from '@/components/blog/react/CategoriesSection';
import { SearchBox } from '@/components/blog/react/SearchBox';
import HeroSection from '@/components/blog/HeroSection.astro';
import ArticleCard from '@/components/blog/ArticleCard.astro';

const posts = await getCollection('blog');
const categoriesEntries = await getCollection('categories');
const categories = categoriesEntries.map(c => c.data);

const sortedPosts = posts.sort((a, b) => 
  b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf()
);

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<Layout 
  title="Blog"
  description="Explore articles on mental health, wellness, and personal growth from the experts at Oasis Health Services."
  schema={getOrganizationSchema()}
>
  <HeroSection>
    <SearchBox slot="search" categories={categories} client:load />
  </HeroSection>

  <CategoriesSection categories={categories} client:load />

  <section class="py-20 bg-gradient-to-b from-gray-50 to-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="mb-12">
        <h2 class="text-3xl font-bold text-[#2D6762]">Latest Articles</h2>
        <p class="text-[#4A5455] mt-2">Explore our most recent insights and guidance.</p>
      </div>
      {posts.length === 0 ? (
        <div class="text-center py-20">
          <p class="text-xl text-[#4A5455]">No posts found.</p>
        </div>
      ) : (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {sortedPosts.map((post) => (
            <ArticleCard article={post} variant="default" />
          ))}
        </div>
      )}
    </div>
  </section>
</Layout>
